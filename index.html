<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Manage Rules</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container">
            <h1>Manage Your Rules</h1>
            <nav>
                <ul>
                    <li><a href="#rules-section">Rules</a></li>
                    <li><a href="#edit-rule">Edit Rule</a></li>
                    <li><a href="#log-section">View Logs</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Section -->
    <main>
        <!-- Section to view and display rules from rules.csv -->
        <section id="rules-section" class="section">
            <div class="container">
                <h2>Your Rules</h2>
                <div id="rules-table">Loading rules...</div>
            </div>
        </section>

        <!-- Section to edit rules -->
        <section id="edit-rule" class="section">
            <div class="container">
                <h2>Edit Rule</h2>
                <textarea id="rule-editor" rows="10" placeholder="Enter or edit your rule..."></textarea>
                <button onclick="processRule()">Submit Rule</button>
                <div id="processed-result"></div>
            </div>
        </section>

        <!-- Section for logging edits -->
        <section id="log-section" class="section">
            <div class="container">
                <h2>Log</h2>
                <div id="log-status">No edits logged yet.</div>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer>
        <div class="container">
            <p>&copy; 2024 Manage Rules</p>
        </div>
    </footer>

    <!-- JavaScript Section -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // Load and display the rules from rules.csv
        fetch('rules.csv')
            .then(response => response.text())
            .then(data => {
                const parsedData = Papa.parse(data, { header: true });
                displayRules(parsedData.data);
            });

        function displayRules(rules) {
            const table = document.createElement('table');
            rules.forEach(rule => {
                const row = document.createElement('tr');
                Object.values(rule).forEach(value => {
                    const cell = document.createElement('td');
                    cell.innerText = value;
                    row.appendChild(cell);
                });
                table.appendChild(row);
            });
            document.getElementById('rules-table').appendChild(table);
        }

        // Process the edited rule using AI API
        async function processRule() {
            const ruleText = document.getElementById('rule-editor').value;
            const response = await fetch('https://api.openai.com/v1/completions', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer YOUR_API_KEY',
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: ruleText,
                    model: 'text-davinci-003',
                    max_tokens: 100,
                }),
            });

            const result = await response.json();
            document.getElementById('processed-result').innerText = result.choices[0].text;

            // Optionally send this data to Make.com
            await saveLog(ruleText);
        }

        // Save log to Make.com or any external service
        async function saveLog(edit) {
            await fetch('https://hook.make.com/your-log-saving-webhook', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ log: edit }),
            });

            document.getElementById('log-status').innerText = 'Edit logged successfully!';
        }
    </script>
</body>
</html>
